## 利用ECG信号对游戏测评系统的设计与实现

### 摘要

在游戏开发过程中，游戏设计人员给游戏注入了“灵魂”。在游戏中，玩家的情感体验是至关重要的，因为其反应了游戏设计是否达到了原本的设计预期。在目前，得到玩家情感体验结果的方法主要还是依靠事后访谈，问卷调查等形式。但是这些方法很难在游戏过程中实时的进行，否则会打破游戏的沉浸感和连续性。相反使用生理数据则可以客观且实时的反映玩家的体验情况[9]。与此同时，对于游戏设计人员，在游戏开发的中后期，能够对玩家在游戏中的量化数据进行可视化，则可以让游戏设计人员更形象直观的理解量化数据，并能反应玩家在游戏时域内各项数据的变化程度。 

本文开发的评测分析系统分为4个模块：游戏运行时游戏内数据采集、游戏运行时玩家ECG数据采集，事后数据分析，数据可视化。 其中采集到的游戏内数据和ECG数据都会保存为相应的数据文件，其内容数据标以时间戳。两份数据最终会在数据分析和可视化模块中进行处理。其中，ECG信号会依次进行去噪过滤，特征R-peak识别，得到在游戏标记事件前后的HR及HRV信息，并能够以可视化形式呈现。与此同时，系统可以结合玩家ECG数据和游戏内触发特殊事件的情绪评分，进行相关性建模和分类。

系统测试阶段，我们设计了一款自定义的恐怖游戏，在游戏中设计了一些调动玩家情绪的事件点，利用该系统，为设计人员提供数据的可视化显示，并对恐怖感程度与HR数学建模，其进行分类（回归），给出预测情感值。并对游戏中的营造恐怖气氛的方法进行分析。

本文的创新点如下：在信号去噪过滤器的算法上，我们结合传统的小波和EMD，然后进行有效的去噪。在ECG中R-peak特征识别算法上，我们基于传统的差分阈值法，进行相应的优化和创新，动态调节阈值及窗口识别。在数学建模计算模块中，基于ECG数据分类情绪算法上，我们对比了传统算法和机器学习类算法的优劣势。在自定义游戏是设计上，我们根据恐怖元素不同的设计方法，在游戏中利用多种呈现恐怖元素的方法，新建了一些游戏中的恐怖事件，根据试验后的问卷，验证了上述方法的呈现效果，同时又基于此游戏，利用我们的系统，对游戏中玩家的数据进行分析和可视化。

### 绪论

##### 论文背景及研究意义

作为第九艺术的游戏产业，仅在国内2021年前半年，游戏市场销售达到1504.93亿。以多样化的电子设备为载体，游戏逐渐突破了在时间和空间上束缚，使得人们无论在何时何地均可以享受到游戏带来的乐趣。在游戏行业和游戏市场的规模日渐庞大的当下，游戏也渗透到诸多领域进行融合，利用游戏中内在娱乐性和趣味性的特点，与教育、军事和医疗保健等不同行业结合而生的“严肃游戏”。游戏无论是娱乐方向还是严肃方向，只是目的不同，而游戏可玩性的本质却并无变化。

玩家在进行游戏体验时，游戏的可玩性体现的至关重要。对于玩家来说，良好的游戏体验可以让其体验到诸多情感，从而达到心流，同时对于游戏本身而言又可以达到其目的。但对于游戏设计者而言，能够在游戏开发中期或后期对游戏的可玩性进行针对性调整就非常有意义。

本文面向游戏设计者，设计并实现基于玩家ECG数据的游戏可视化测评系统。利用此系统对玩家在游戏过程中的ECG数据进行收集，进而对其进行识别，分析，可视化。通过玩家的生理数据预测游戏内特定事件触发后玩家的情绪变化，以便让游戏设计者更精确的对玩家的情绪调动进行分析。同时，在游戏过程中时间序列上记录玩家的游戏内数据，让游戏设计者可以直观的了解游戏内玩家的空间热区的变化。最终开发人员利用此系统使游戏设计量化可控。从而提升游戏质量（可玩性）。



##### 心电信号生理基础

介绍有哪些常见的生理信号可以在实验中获得，例如 ECG，EMG，EEG，GSR等，使用它们分别可以客观表现出情绪的某些方面或维度。但是获得其生理数据的设备有些具有侵入性EMG、EEG，使用其设备给玩家进行数据收集时非常不便捷，而且影响玩家在游戏时的体验效果；而GSR设备会被游戏体验中的轻微的运动摩擦和环境的湿度所干扰。那么ECG则是最好的选择，其特征值也非常多，便于进行数据采集。

介绍心电信号的生理基础P波，QRS波群，T波，U波。RR间期和HRV可以被识别作为参考点。

介绍心电信号设备的相关内容，为何选择文章中使用的双电极设备。设备的分类，根据侵入性不同，他们的便捷性和准确性的不同，如何处理其信号的噪音和找出RR的HRV相关算法

##### 数据可视化

数据可视化的相关研究，

这样让游戏设计者可以直观地了解到游戏中特定的设计带给玩家的生理变化和情感体验。

游戏设计者也可以了解到自己给玩家“模糊”安排的路线。

##### 论文的结构安排

第一章：绪论。论述了课题来源，研究意义以及此系统的大致规划。

第二章：国内外研究现状和关键技术：ECG与情绪的相关性研究，ECG的去噪技术，ECG特征值的识别技术，可视化研究。同时，基于本文自定义测试游戏的恐怖游戏及情节的相关研究。

第三章：介绍系统的总体方案设计。分别叙述了ECG以及游戏内数据的采集模块，数据预处理和分析模块，数据的可视化模块。

第四章：展开叙述ECG以及游戏内数据的采集模块。分为上位机应用程序开发来实时采集ECG数据并保存，游戏内事件点触发记录的玩家数据。

第五章：展开叙述ECG处理和分析模块，分为对ECG数据的去噪，R-peak特征识别，基于ECG数据和游戏内事件点评分的数学建模。便于游戏设计人员进行客观的分析。

第六章：展开叙述在游戏内，基于时序或空间的数据可视化，便于游戏设计人员直观获得游戏的设计效果。

第七章：基于我们自定义的游戏，对系统中上述模块进行测试，完成对系统的整体测试和验收。

总结：对整篇论文进行总结，提出未来目标。

### 国内外研究现状

1. ##### 国外研究：

   - 生理数据反应玩家情绪和游戏体验的可行性。
   - ECG与心理变化的关系，ECG中RR和HRV分别可以反应的部分。
   - 利用机器学习的方法对生理数据和游戏数据及评价。(PS.有需要就写机器学习相关)
   - 生理数据同游戏内数据，传统数学建模，自圆其说。 
   - 数据可视化

2. ##### 国内研究：

   - 生理数据的预处理去噪过滤。
   - RR识别算法。
   - 生理数据同游戏体验的关系。
   - 机器学习识别生理数据特征。
   - 数据可视化

### 系统的总体方案设计

##### 引言

该系统符合游戏的体验流程，以及事后的数据分析流程。游戏中的玩家在进行数据收集，同时玩家在游戏进行时的ECG数据被传感器收集。此时两份含有时间戳的数据记录文件交给数据处理模块，ECG作为传感器收集的自然数据，必然需要进行去噪处理，之后，对ECG进行特征识别。识别后的数据结合游戏内数据整合导出，进行可视化展示。该系统在进行大量的数据分析后，结合玩家的问卷调查的标记特征位后，可进行统计建模，对后续的ECG数据进行分类预测。

```mermaid
graph LR
style model fill:#ff0
style pre fill:#00BFFF
style pre fill:#00BFFF
style 数据采集模块___ fill:#66CD00
style 可视化模块___ fill:#FF8C00

subgraph 数据采集模块___
game(游戏数据收集___) --> file_1(记录文件1__)
player(玩家ECG收集___) --> file_2(记录文件2___)
end
flag(玩家问卷标记____)--> pre
subgraph 数据处理模块___
	file_1 -->	pre(数据预处理___)
	file_2 -->	pre
	pre --> analyse(分析数据__)
	analyse --> model(统计建模__)
	analyse --> package(整合导出__)
end 
model --> res(分类预测__)	

subgraph 可视化模块___
package --> ob(可视化__)
end

```

##### 数据的采集模块

##### 数据格式的设计

##### 数据预处理和分析模块

##### 数据的可视化模块

### 玩家的相关数据采集

##### ECG信号及其采集原理

ECG信号波介绍

基于电位差的ECG波产生原理

介绍基于电位差采集ECG数据的硬件，注意事项

##### ECG信号的上位机开发

ECG数据和游戏内数据的采集架构

传感器和PC的数据传输

ECG数据和游戏内数据的保存

##### 此模块流程总结

### ECG数据的处理和分析

##### 现有ECG数据去噪方法

噪声产生的原因和噪声分类

现有主流的去噪过滤方法：（中值，小波，EMD，VMD）

##### 本文采用的去噪方法

本文用（小波和EMD结合），回答为什么？

##### 现有ECG特征波的识别方法

差分阈值法

##### 本文采用的特征波识别方法

差分阈值法的改良

##### RR间隔与情绪（评价）的建模分类

游戏测试期间的评价系统。传统游戏问卷评价的主观性和延迟性导致的不准确，而生理数据是情绪的客观反映，通过玩家在游戏过程中进行非侵入式生理数据的采集，数据建模后可以不再进行问卷测评，直接通过生理数据计得出游戏的评价。且此系统整合得出的相关数据，进行时间和空间中的可视化，则便于策划人员进行游戏模块开发中进行分析。

###### 可行性分析：

数据分布分析，相关性分析

###### 常有的分类或者回归方法：

统计学常有线性回归、非线性回归

机器学习中的梯度下降分类（SGD classifier）、随机森林分类（Random Forest Classifier），支持向量机分类（SVM）[PS.数据量不足]

### 数据可视化

##### 生理数据可视化

##### 游戏内数据可视化

##### 在时间域上的表达

##### 在空间域上的表达

### 系统的实验和测试

##### 自定义恐怖游戏的设计

游戏情节设计及评价（游戏设计及调查问卷）

- 为什么选择PC作为游戏平台
- 为什么选择恐怖游戏
- 为什么如此设计游戏情节
- 此方式设计游戏和评价相关性分析

##### 测试实验安排

实验安排和流程，回答为什么。

##### 实验后问卷收集

##### 数据收集测试

##### 数据分析测试

##### 可视化效果测试 

##### 实验结果分析

分析得出系统在实际游戏开发中的应用价值，同时该实验得出此游戏开发中的设计结论。

### 总结与展望

##### 本文结论

##### 未来展望